<div [hidden]="isHidden" class="overlay mt-overlay modal fade" [ngClass]="{'show-modal': !this.isHidden}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title">Create Issue</h4>
        <button type="button" class="close" aria-label="Close" (click)="hideModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="row">
          <div class="col-sm-12">
            <input type="text" class="form-control" placeholder="Title" [(ngModel)]="issue.title">
          </div>
        </div>

        <div class="row">
          <br class="col-sm-12">
        </div>

        <div class="row">
          <div class="col-sm-8">
            <label for="issue-description">Description:</label>
            <textarea id="issue-description" class="form-control" placeholder="Description" name="description"
              [(ngModel)]="issue.description"></textarea>
          </div>
          <div class="col-sm-4 issue-fields">
            <div class="col-sm-12 no-padding">
              <label for="issue-resolution">Resolution*:</label>
              <lookup-colored *ngIf="resolutions" id="issue-resolution" [cutLongText]="true" [colorProperty]="'color'"
                [propertiesToShow]="['name']" [array]="resolutions" placeholder="Resolution" [allowEmptyValue]="false"
                [model]="issue.resolution" (modelChange)="updateResolution($event)">
              </lookup-colored>
            </div>
            <div class="col-sm-12 no-padding">
              <label for="issue-assignee">Assignee:</label>
              <lookup-autocomplete *ngIf="users" id="issue-assignee" [cutLongText]="true"
                [propertiesToShow]="['first_name', 'second_name']" [array]="users" placeholder="Assignee"
                [allowEmptyValue]="true" [model]="issue.assignee" (modelChange)="updateAssignee($event)">
              </lookup-autocomplete>
            </div>
            <div class="col-sm-12 no-padding">
              <label for="issue-expression">Regular Expression:</label>
              <input id="issue-expression" type="text" class="form-control" placeholder="Regular Expression" [ngClass]="{
                  'is-valid': isExpressionOverlapped(), 
                  'is-invalid': isExpressionOverlapped()
                  }" [(ngModel)]="issue.expression" (keyup)="onExpressionUpdate($event)">
              <div class="invalid-feedback">
                Expression is overlapped!
              </div>
            </div>
            <div *ngIf="issue.expression" class="col-sm-12 no-padding row-with-switch" title="Assign this issue to all results where Fail Reason fits the Expression and without assigned issue">
              <ui-switch class="clearfix" size="small" [(ngModel)]="updateResults" id="update-results"></ui-switch>
              <label class="update-results-label" for="update-results">Add to Results without issue</label>
            </div>
            <div class="col-sm-12 no-padding">
              <label for="issue-external-url">External Issue:</label>
              <input id="issue-external-url" type="text" class="form-control" placeholder="External Issue"
                [(ngModel)]="issue.external_url">
            </div>
          </div>
          
        </div>

        <div class="col-sm-12 no-padding" *ngIf="overlappedIssues && columns && overlappedIssues.length > 0">
          <p>The Regular Expression is overlapped with:</p>
          <table-filter id="overlapped-issues-table" [data]="overlappedIssues" [columns]="columns" rowsOnPage="3"
            [hidePageSets]="true" [hideFilter]="true" [columnManagement]="false">
          </table-filter>
        </div>

        <div class="col-sm-12 modal-footer modal-buttons">
          <div class="modal-buttons-form">
            <button *ngFor="let button of buttons" type="button" autofocus (click)="doAction(button.execute)"
              class="btn btn-sm btn-secondary" [ngClass]="{
              'btn-secondary': !button.execute,
              'btn-success': button.execute
          }">{{button.name}}</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>